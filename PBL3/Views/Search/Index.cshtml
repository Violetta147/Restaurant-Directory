@model SearchResultsViewModel
@{
    ViewData["Title"] = "Search Results";
}

@section Styles {
    <!-- Mapbox GL CSS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/search-results.css" asp-append-version="true">
}

<!-- Hidden fields to pass data to JavaScript -->
<input type="hidden" id="mapbox-token" value="YOUR_MAPBOX_ACCESS_TOKEN">
<input type="hidden" id="map-initial-lat" value="@Model.Center.Latitude">
<input type="hidden" id="map-initial-lng" value="@Model.Center.Longitude">
<input type="hidden" id="map-initial-query" value="@Model.Query">
<input type="hidden" id="map-initial-category" value="@Model.Category">

<!-- 3-column layout following Yelp-style UI -->
<div id="yelp-style-results-layout">
    <!-- LEFT PANEL: Categories & Filters -->
    <div id="filters-sidebar-frame">
        <h2 class="text-xl font-bold mb-4 text-gray-800">Filters</h2>

        <!-- Categories -->
        <div id="categories-filter-container" class="mb-6">
            <h3 class="font-semibold mb-2">Cuisine</h3>
            <div class="space-y-2">
                <label class="flex items-center">
                    <input type="checkbox" class="category-checkbox rounded mr-2" value="Italian">
                    <span>Italian</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" class="category-checkbox rounded mr-2" value="Mexican">
                    <span>Mexican</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" class="category-checkbox rounded mr-2" value="Japanese">
                    <span>Japanese</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" class="category-checkbox rounded mr-2" value="Vietnamese">
                    <span>Vietnamese</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" class="category-checkbox rounded mr-2" value="American">
                    <span>American</span>
                </label>
            </div>
        </div>

        <!-- Price Range -->
        <div id="price-filter-container" class="mb-6">
            <h3 class="font-semibold mb-2">Price Range</h3>
            <div class="flex space-x-2">
                <button class="price-filter px-3 py-1 border rounded-full hover:bg-primary hover:text-white" data-price="1">$</button>
                <button class="price-filter px-3 py-1 border rounded-full hover:bg-primary hover:text-white" data-price="2">$$</button>
                <button class="price-filter px-3 py-1 border rounded-full hover:bg-primary hover:text-white" data-price="3">$$$</button>
                <button class="price-filter px-3 py-1 border rounded-full hover:bg-primary hover:text-white" data-price="4">$$$$</button>
            </div>
        </div>

        <!-- Rating Filter -->
        <div id="rating-filter-container" class="mb-6">
            <h3 class="font-semibold mb-2">Rating</h3>
            <div class="space-y-2">
                <label class="flex items-center">
                    <input type="radio" name="rating" class="rating-radio rounded mr-2" value="4">
                    <span>4+ Stars</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="rating" class="rating-radio rounded mr-2" value="3">
                    <span>3+ Stars</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="rating" class="rating-radio rounded mr-2" value="2">
                    <span>2+ Stars</span>
                </label>
                <label class="flex items-center">
                    <input type="radio" name="rating" class="rating-radio rounded mr-2" value="0">
                    <span>Any</span>
                </label>
            </div>
        </div>

        <!-- Apply Filters Button -->
        <button id="apply-filters-btn" class="w-full bg-primary text-white py-2 rounded hover:bg-secondary transition">
            Apply Filters
        </button>
    </div>

    <!-- CENTER: Restaurant Results List -->
    <div id="restaurant-results-frame">
        <div id="search-results-header" class="mb-4">
            <h2 class="text-2xl font-bold text-gray-800">
                @if (!string.IsNullOrEmpty(Model.Query))
                {
                    <text>Best "@Model.Query" restaurants</text>

                    if (!string.IsNullOrEmpty(Model.LocationQuery))
                    {
                        <text> near @Model.LocationQuery</text>
                    }
                }
                else
                {
                    <text>Popular Restaurants</text>

                    if (!string.IsNullOrEmpty(Model.LocationQuery))
                    {
                        <text> near @Model.LocationQuery</text>
                    }
                }
            </h2>
        </div>

        <div id="restaurant-list-container" class="space-y-6">
            @if (Model.Restaurants != null && Model.Restaurants.Any())
            {
                @foreach (var restaurant in Model.Restaurants)
                {
                    <div class="restaurant-item bg-white rounded-lg shadow-md overflow-hidden"
                         data-id="@restaurant.Id"
                         data-lat="@restaurant.Latitude"
                         data-lng="@restaurant.Longitude">
                        <div class="flex flex-col md:flex-row">
                            <div class="md:w-1/3">
                                <img src="https://via.placeholder.com/300x200?text=@Uri.EscapeDataString(restaurant.Name)" alt="@restaurant.Name" class="w-full h-full object-cover">
                            </div>
                            <div class="p-4 md:w-2/3">
                                <div class="flex justify-between items-start">
                                    <h3 class="text-xl font-bold">@restaurant.Name</h3>
                                    <div class="flex items-center bg-gray-100 text-gray-800 px-2 py-1 rounded">
                                        <i class="fas fa-star mr-1 text-yellow-500"></i>
                                        <span>@restaurant.Rating</span>
                                    </div>
                                </div>
                                <div class="flex items-center text-gray-600 mt-1">
                                    <span>@restaurant.Category</span>
                                    <span class="mx-2">•</span>
                                    <span>@restaurant.Address</span>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">Open</span>
                                    <button class="view-on-map-btn text-primary font-medium hover:underline">View on Map</button>
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <!-- Pagination using XPageList HTML helpers -->
                <div class="mt-8 flex justify-center">
                    @Html.PagedListPager((IPagedList)Model.Restaurants, page => Url.Action("Index", new
                        {
                            q = Model.Query,
                            location = Model.LocationQuery,
                            category = Model.Category,
                            page
                        }), new PagedListRenderOptions
           {
               LiElementClasses = new string[] { "px-3", "py-1", "rounded", "border", "text-gray-600", "hover:bg-gray-100", "mx-1" },
               ActiveLiElementClass = "bg-primary text-white"
           })
                </div>
            }
            else
            {
                <div class="text-center py-10">
                    <p class="text-lg text-gray-500">No restaurants found matching your criteria.</p>
                    <p class="text-gray-500">Try adjusting your filters or search terms.</p>
                </div>
            }
        </div>
    </div>

    <!-- RIGHT: Map Display -->
    <div id="map-sidebar-frame">
        <button id="reload-map-button" class="font-medium">
            <i class="fas fa-sync-alt mr-1"></i> Show restaurants in this area
        </button>
        <div id="mapbox-container"></div>
    </div>
</div>

@section Scripts {
    <!-- Mapbox GL JS -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js"></script>
    <script src="~/js/search-map.js" asp-append-version="true"></script>
}